#!/bin/bash
linux_dir=(you directory path in the server where raw videos are there)
windows_ip=(your machine ip)
win_user=(your ssh windows wsl username)
windows_dest=(windows folder path where the copied raw videos are stored )
linux_out=(path where your transcoded videos will be recieved in server)
ssh_pass=(your wsl ssh password)
encoded_dir=(directory in your windows where transcoded files are stored)
echo "Transferring files to Windows"
sshpass -p "$ssh_pass" rsync -av -e "ssh" "$linux_dir" "$win_user@$wi>echo "Starting ffmpeg transcoding in Windows..."
sshpass -p "$ssh_pass" ssh -T "$win_user@$windows_ip" <<EOF
    find "${windows_dest}" -mindepth 1 -type f -name "*.mkv" -print0 >
        filename=\$(basename "\$file")
        echo "Processing: \$filename"

        output_file="${encoded_dir}/\${filename%.*}_transcoded.mp4"
        # Check if the file has English subtitles

        ffmpeg -y -hwaccel cuda -i "\$file" \
            -nostdin -map 0:v \
    -map 0:a:m:language:jpn? \
    -map 0:s:m:language:eng? \
    -map_chapters 0 \
    -vf "scale='min(iw,1920)':-2" \
    -c:v hevc_nvenc -preset slow -rc vbr_hq \
    -b:v 2.5M -maxrate 3M -bufsize 3M \
    -rc-lookahead 32 -spatial-aq 1 -aq-strength 8 -tune hq \
    -c:a copy \
    -c:s mov_text \
    -movflags +faststart "\$output_file"

        echo "Finished: \$output_file"
    done
EOF
##echo "Waiting for transcoded files..."

#w hile true; do
  # if sshpass -p "$ssh_pass" ssh "$win_user@$windows_ip" "[ -n \"\$(>   #     break
    #fi
    #sleep 10                                                         # done


echo "Transferring transcoded files back to Linux..."
sshpass -p "$ssh_pass" rsync -av -e "ssh" "$win_user@$windows_ip:$enc>

echo "Cleaning up Windows directory..."
echo "Cleaning $encoded_dir ..."
sshpass -p "$ssh_pass" ssh "$win_user@$windows_ip" "if [ -d \"$encode>
echo "Cleaning $windows_dest ..."

sshpass -p "$ssh_pass" ssh "$win_user@$windows_ip" "if [ -d \"$window>echo "Transcoding completed"
